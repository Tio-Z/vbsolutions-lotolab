<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>LotoLab • Gerador PRO</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#07090f;--card:#0c111a;--stroke:#1d2638;--muted:#9aa3b2;--text:#f3f7ff;--primary:#3A86FF}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:'Inter',sans-serif}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
.tabs{display:flex;gap:10px;margin:8px 0 14px}
.tab{padding:10px 14px;border:1px solid var(--stroke);border-radius:12px;cursor:pointer;background:#0b1324}
.tab.active{background:linear-gradient(135deg,#5dd2ff 0%,#a07bff 100%);color:#0b1220;border-color:transparent;font-weight:800}
.card{background:var(--card);border:1px solid var(--stroke);border-radius:16px;padding:18px;margin-top:10px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.col-6{grid-column:span 6}.col-3{grid-column:span 3}.col-12{grid-column:span 12}
label{display:block;font-weight:700;margin-bottom:6px}
.muted{color:var(--muted)} .combo{background:#0c1323;border:1px dashed #2b3957;border-radius:12px;padding:10px;margin:6px 0}
input,select,button{border-radius:12px;border:1px solid var(--stroke);background:#0e1523;color:#fff;padding:12px}
button.primary{background:#0b1220;border:2px solid var(--primary);font-weight:800}
</style>
</head>
<body>
<div class="wrap">
  <h1 style="font-family:'Poppins',sans-serif">Gerador PRO</h1>
  <div class="tabs">
    <div class="tab active" data-game="mega">Mega-Sena</div>
    <div class="tab" data-game="loto">Lotofácil</div>
  </div>

  <div class="card">
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px">
      <div>Concursos carregados: <b id="kLoaded">0</b></div>
      <div>Amostra usada: <b id="kSample">—</b></div>
      <div>Jogo: <b id="kGame">Mega-Sena</b></div>
    </div>
    <div class="grid">
      <div class="col-6">
        <label>Usar últimos <span id="nLabel">50</span> concursos</label>
        <input id="nDraws" type="range" min="10" max="50" value="50" style="width:100%">
        <label class="muted" style="display:block;margin-top:6px"><input id="allDraws" type="checkbox"> Usar todos</label>
      </div>
      <div class="col-3">
        <label>Metodologia</label>
        <select id="method">
          <option value="equilibrio">Equilíbrio</option>
          <option value="antiquente">Anti-Quente</option>
          <option value="minseq">Mínima sequência</option>
        </select>
      </div>
      <div class="col-3">
        <label>Combinações</label>
        <select id="qty"><option>3</option><option>5</option><option>10</option></select>
      </div>
      <div class="col-12"><button id="go" class="primary">Gerar combinações</button></div>
    </div>
    <hr style="border:none;border-top:1px solid var(--stroke);margin:16px 0">
    <div id="out" class="muted">Carregando dados…</div>
  </div>
</div>
<script>
const state={game:'mega',draws:[],version:'FIX9-'+new Date().toISOString().slice(0,10)};
const ui={kLoaded:byId('kLoaded'),kSample:byId('kSample'),kGame:byId('kGame'),nDraws:byId('nDraws'),nLabel:byId('nLabel'),allDraws:byId('allDraws'),out:byId('out'),qty:byId('qty'),method:byId('method')};
function byId(id){return document.getElementById(id)}
function url(){return state.game==='mega'?'/data/mega.json':'/data/loto.json'}
function bust(u){return u+(u.includes('?')?'&':'?')+'v='+state.version+'-'+Date.now()}

async function loadData(){
  ui.out.textContent='Carregando dados…';
  try{
    const res=await fetch(bust(url()),{cache:'no-store'}); if(!res.ok) throw new Error('HTTP '+res.status);
    const data=await res.json();
    state.draws=normalize(data);
    const total=state.draws.length;
    ui.kLoaded.textContent=total;
    const min=Math.max(10,Math.min(50,Math.floor(total*0.1)));
    ui.nDraws.min=Math.max(10,Math.min(min,total));
    ui.nDraws.max=Math.max(ui.nDraws.min,total);
    if(+ui.nDraws.value>total) ui.nDraws.value=Math.min(50,total);
    syncSample();
    ui.kGame.textContent=state.game==='mega'?'Mega-Sena':'Lotofácil';
    ui.out.textContent='Dados carregados. Pronto para gerar.';
  }catch(e){ ui.out.innerHTML='<span style="color:#ff6">Falha ao carregar: '+e.message+'</span>'; }
}
// Aceita vários formatos de JSON
function normalize(json){
  if(Array.isArray(json)) return coerce(json);
  if(json&&Array.isArray(json.rows)) return coerce(json.rows);
  if(json&&Array.isArray(json.concursos)) return json.concursos.map(r=>(r.dezenas||r.numeros||[]).map(Number));
  if(json&&Array.isArray(json.resultados)) return json.resultados.map(r=>(r.dezenas||r.numeros||[]).map(Number));
  return [];
}
function coerce(arr){
  return arr.map(row=>{
    if(Array.isArray(row)) return row.slice(2).map(x=>+String(x).replace(/\D+/g,''));
    if(row&&typeof row==='object'){ const xs=row.dezenas||row.numeros||row.n||[]; return Array.isArray(xs)?xs.map(Number):[]; }
    return [];
  }).filter(a=>a.length>0);
}
function syncSample(){
  const total=state.draws.length;
  if(ui.allDraws.checked){ ui.nDraws.disabled=true; ui.nLabel.textContent='TODOS'; byId('kSample').textContent='TODOS'; }
  else{ ui.nDraws.disabled=false; const n=Math.min(+ui.nDraws.value,total); ui.nLabel.textContent=String(n); byId('kSample').textContent=String(n); }
}
ui.nDraws.addEventListener('input',()=>{ui.allDraws.checked=false; syncSample();});
ui.allDraws.addEventListener('change', syncSample);
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
  state.game=t.getAttribute('data-game'); ui.allDraws.checked=false; ui.nDraws.value=Math.min(50,+ui.nDraws.max); syncSample(); loadData();
}));
function pickUnique(k,max){ const s=new Set(); while(s.size<k) s.add(1+Math.floor(Math.random()*max)); return Array.from(s).sort((a,b)=>a-b); }
function generateOne(){ return state.game==='mega'?pickUnique(6,60):pickUnique(15,25); }
function generate(){
  const total=state.draws.length; if(!total){ui.out.innerHTML='<span style="color:#ff6">Dados não carregados.</span>'; return;}
  const useAll=ui.allDraws.checked; const N=useAll?total:Math.min(+ui.nDraws.value,total); const qty=+ui.qty.value;
  let html=''; for(let i=0;i<qty;i++){ const nums=generateOne(); html+=`<div class="combo"><b>#${i+1}</b> — ${nums.join(' - ')} <span class="muted">(${useAll?'TODOS':('N='+N)}, ${state.game==='mega'?'6 de 60':'15 de 25'})</span></div>`; }
  ui.out.innerHTML=html||'<span class="muted">Nada gerado.</span>';
}
byId('go').addEventListener('click', generate);
loadData(); syncSample();
</script>
</body></html>
